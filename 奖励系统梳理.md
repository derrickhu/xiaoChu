# ã€Šäº”è¡Œé€šå¤©å¡”ã€‹å¥–åŠ±ç³»ç»Ÿæ¢³ç†

> æ¢³ç†æ—¶é—´ï¼š2026-02-19
> æ¶‰åŠæ–‡ä»¶ï¼štower.jsã€skills.jsã€battle.jsã€runManager.jsã€touchHandlers.jsã€eventView.js

---

## ä¸€ã€æˆ˜æ–—ç»“ç®—åŠ æˆå¥–åŠ±

### 1.1 å¥–åŠ±ç”Ÿæˆè§„åˆ™ï¼ˆgenerateRewardsï¼‰

| æˆ˜æ–—ç±»å‹ | å¥–åŠ±å†…å®¹ | é€Ÿé€š(â‰¤5å›åˆ)é¢å¤–å¥–åŠ± |
|---------|---------|-------------------|
| æ™®é€šæˆ˜æ–— | 85%æ¦‚ç‡ï¼š3ä¸ªå°æ¡£buffä¸‰é€‰ä¸€ï¼›15%æ¦‚ç‡ï¼š1åªçµå…½+2ä¸ªå°æ¡£buffä¸‰é€‰ä¸€ | +1ä¸ªé€Ÿé€šbuffï¼ˆå˜å››é€‰ä¸€ï¼‰ |
| ç²¾è‹±æˆ˜æ–— | 3åªçµå…½ä¸‰é€‰ä¸€ | +1åªçµå…½ï¼ˆå˜å››é€‰ä¸€ï¼‰ |
| BOSSæˆ˜æ–— | 3ä»¶æ³•å®ä¸‰é€‰ä¸€ | +1ä»¶æ³•å®ï¼ˆå˜å››é€‰ä¸€ï¼‰ |

### 1.2 å°æ¡£åŠ æˆæ± ï¼ˆBUFF_POOL_MINORï¼Œæ™®é€šæˆ˜æ–—æ‰è½ï¼Œå…±14ä¸ªï¼‰

| ID | åç§° | buffå­—æ®µ | æ•°å€¼ | ä»£ç ç”Ÿæ•ˆ | çŠ¶æ€ |
|----|------|---------|------|---------|------|
| m1 | å…¨é˜Ÿæ”»å‡» +2% | allAtkPct | +2 | âœ… battle.js:186 æ¶ˆé™¤è®¡ç®—ä¹˜æ•° | æ­£å¸¸ |
| m2 | å…¨é˜Ÿæ”»å‡» +3% | allAtkPct | +3 | âœ… åŒä¸Š | æ­£å¸¸ |
| m3 | ä¸»è§’è¡€é‡ä¸Šé™ +3% | hpMaxPct | +3 | âœ… skills.js:238 å³æ—¶é‡ç®—heroMaxHp | æ­£å¸¸ |
| m4 | ä¸»è§’è¡€é‡ä¸Šé™ +5% | hpMaxPct | +5 | âœ… åŒä¸Š | æ­£å¸¸ |
| m5 | å¿ƒç å›å¤æ•ˆæœ +5% | heartBoostPct | +5 | âœ… battle.js:168 å¿ƒç å›å¤ä¹˜æ•° | æ­£å¸¸ |
| m6 | Comboä¼¤å®³ +2% | comboDmgPct | +2 | âœ… battle.js:318,456 comboå€ç‡ä¹˜æ•° | æ­£å¸¸ |
| m7 | 3æ¶ˆåŸºç¡€ä¼¤å®³ +3% | elim3DmgPct | +3 | âœ… battle.js:156 æ¶ˆé™¤å€ç‡ä¹˜æ•° | æ­£å¸¸ |
| m8 | è½¬ç æ“ä½œæ—¶é—´ +0.2ç§’ | extraTimeSec | +0.2 | âœ… battle.js:806 enterBattleè®¡ç®—æ‹–æ‹½æ—¶é™ | æ­£å¸¸ |
| m9 | æ¯å›åˆè‡ªåŠ¨å›è¡€ +1 | regenPerTurn | +1 | âœ… battle.js:557 applyFinalDamageä¸­å›è¡€ | æ­£å¸¸ |
| m10 | å—åˆ°ä¼¤å®³ -2% | dmgReducePct | +2 | âœ… battle.js:638 enemyTurnå‡ä¼¤è®¡ç®— | æ­£å¸¸ |
| m11 | æ‰€æœ‰æ€ªç‰©æ”»å‡» -2% | enemyAtkReducePct | +2 | âœ… battle.js:778 enterBattleå‰Šå¼±æ•Œäºº | æ­£å¸¸ |
| m12 | æ‰€æœ‰æ€ªç‰©è¡€é‡ -2% | enemyHpReducePct | +2 | âœ… battle.js:781 enterBattleå‰Šå¼±æ•Œäºº | æ­£å¸¸ |
| m13 | ä¸»è§’ç«‹å³æ¢å¤15%è¡€é‡ | healNow | 15 | âœ… skills.js:265 å³æ—¶å›è¡€ | æ­£å¸¸ |
| m14 | æˆ˜æ–—ç»“æŸåé¢å¤–å›è¡€5% | postBattleHeal | 5 | âœ… battle.js:582 èƒœåˆ©æ—¶å›è¡€ | æ­£å¸¸ |

### 1.3 ä¸­æ¡£åŠ æˆæ± ï¼ˆBUFF_POOL_MEDIUMï¼Œå…±16ä¸ªï¼‰

| ID | åç§° | buffå­—æ®µ | æ•°å€¼ | ä»£ç ç”Ÿæ•ˆ | çŠ¶æ€ |
|----|------|---------|------|---------|------|
| e1 | å…¨é˜Ÿæ”»å‡» +5% | allAtkPct | +5 | âœ… | æ­£å¸¸ |
| e2 | ä¸»è§’è¡€é‡ä¸Šé™ +8% | hpMaxPct | +8 | âœ… | æ­£å¸¸ |
| e3 | å¿ƒç å›å¤æ•ˆæœ +10% | heartBoostPct | +10 | âœ… | æ­£å¸¸ |
| e4 | Comboä¼¤å®³ +5% | comboDmgPct | +5 | âœ… | æ­£å¸¸ |
| e5 | 4æ¶ˆä¼¤å®³ +8% | elim4DmgPct | +8 | âœ… battle.js:157 | æ­£å¸¸ |
| e6 | äº”è¡Œå…‹åˆ¶ä¼¤å®³ +5% | counterDmgPct | +5 | âœ… battle.js:371,501 | æ­£å¸¸ |
| e7 | çµå…½æŠ€èƒ½ä¼¤å®³ +5% | skillDmgPct | +5 | âœ… skills.js:105,191 | æ­£å¸¸ |
| e8 | çµå…½æŠ€èƒ½CDç¼©çŸ­ +5% | skillCdReducePct | +5 | âœ… skills.js:18 | æ­£å¸¸ |
| e9 | è½¬ç æ“ä½œæ—¶é—´ +0.3ç§’ | extraTimeSec | +0.3 | âœ… | æ­£å¸¸ |
| e10 | æ¯å›åˆè‡ªåŠ¨å›è¡€ +2 | regenPerTurn | +2 | âœ… | æ­£å¸¸ |
| e11 | å—åˆ°ä¼¤å®³ -3% | dmgReducePct | +3 | âœ… | æ­£å¸¸ |
| e12 | ç²¾è‹±æ€ªæ”»å‡» -5% | eliteAtkReducePct | +5 | âœ… battle.js:779 | æ­£å¸¸ |
| e13 | ç²¾è‹±æ€ªè¡€é‡ -5% | eliteHpReducePct | +5 | âœ… battle.js:779 | æ­£å¸¸ |
| e14 | ä¸»è§’ç«‹å³æ¢å¤30%è¡€é‡ | healNow | 30 | âœ… | æ­£å¸¸ |
| e15 | ä¸‹ä¸€åœºå—åˆ°ä¼¤å®³é™ä½20% | nextDmgReduce | 20 | âœ… battle.js:639 + èƒœåˆ©åæ¸…é›¶ | æ­£å¸¸ |
| e16 | æˆ˜æ–—ç»“æŸåé¢å¤–å›è¡€10% | postBattleHeal | 10 | âœ… | æ­£å¸¸ |

> âš ï¸ **æ³¨æ„**ï¼šBUFF_POOL_MEDIUM åœ¨å½“å‰ `generateRewards` ä¸­**æœªè¢«ç›´æ¥ä½¿ç”¨**ã€‚ç²¾è‹±æˆ˜å¥–åŠ±æ˜¯çµå…½ä¸‰é€‰ä¸€ï¼Œä¸ä»ä¸­æ¡£buffæ± æŠ½å–ã€‚æ­¤æ± ä»…åŠ å…¥äº† `ALL_BUFF_REWARDS` åˆé›†ï¼Œä½†è¯¥åˆé›†åœ¨å½“å‰ä»£ç ä¸­ä¹Ÿæœªè¢«å¼•ç”¨ã€‚**å±äºé¢„ç•™è®¾è®¡ï¼Œæš‚æœªç”Ÿæ•ˆã€‚**

### 1.4 å¤§æ¡£åŠ æˆæ± ï¼ˆBUFF_POOL_MAJORï¼Œå…±18ä¸ªï¼‰

| ID | åç§° | buffå­—æ®µ | æ•°å€¼ | ä»£ç ç”Ÿæ•ˆ | çŠ¶æ€ |
|----|------|---------|------|---------|------|
| M1 | å…¨é˜Ÿæ”»å‡» +8% | allAtkPct | +8 | âœ… | æ­£å¸¸ |
| M2 | ä¸»è§’è¡€é‡ä¸Šé™ +12% | hpMaxPct | +12 | âœ… | æ­£å¸¸ |
| M3 | å¿ƒç å›å¤æ•ˆæœ +15% | heartBoostPct | +15 | âœ… | æ­£å¸¸ |
| M4 | Comboä¼¤å®³ +8% | comboDmgPct | +8 | âœ… | æ­£å¸¸ |
| M5 | 5æ¶ˆä¼¤å®³ +12% | elim5DmgPct | +12 | âœ… battle.js:158 | æ­£å¸¸ |
| M6 | äº”è¡Œå…‹åˆ¶ä¼¤å®³ +8% | counterDmgPct | +8 | âœ… | æ­£å¸¸ |
| M7 | çµå…½æŠ€èƒ½ä¼¤å®³ +8% | skillDmgPct | +8 | âœ… | æ­£å¸¸ |
| M8 | çµå…½æŠ€èƒ½CDç¼©çŸ­ +10% | skillCdReducePct | +10 | âœ… | æ­£å¸¸ |
| M9 | è½¬ç æ“ä½œæ—¶é—´ +0.5ç§’ | extraTimeSec | +0.5 | âœ… | æ­£å¸¸ |
| M10 | æ¯å›åˆè‡ªåŠ¨å›è¡€ +3 | regenPerTurn | +3 | âœ… | æ­£å¸¸ |
| M11 | å—åˆ°ä¼¤å®³ -5% | dmgReducePct | +5 | âœ… | æ­£å¸¸ |
| M12 | æ¶ˆé™¤é¢å¤– +1è¿å‡» | bonusCombo | +1 | âœ… battle.js:151 é¦–æ¬¡æ¶ˆé™¤æ—¶+N | æ­£å¸¸ |
| M13 | 5æ¶ˆçœ©æ™• +1å›åˆ | stunDurBonus | +1 | âœ… battle.js:160 | æ­£å¸¸ |
| M14 | BOSSæ”»å‡» -5% | bossAtkReducePct | +5 | âœ… battle.js:780 | æ­£å¸¸ |
| M15 | BOSSè¡€é‡ -5% | bossHpReducePct | +5 | âœ… battle.js:780 | æ­£å¸¸ |
| M16 | ä¸»è§’ç«‹å³æ¢å¤50%è¡€é‡ | healNow | 50 | âœ… | æ­£å¸¸ |
| M17 | ä¸‹ä¸€åœºå—åˆ°ä¼¤å®³é™ä½30% | nextDmgReduce | 30 | âœ… | æ­£å¸¸ |
| M18 | æœ¬å±€é¢å¤–1æ¬¡å¤æ´»æœºä¼š | extraRevive | +1 | âœ… runManager.js:175 onDefeatæ¶ˆè´¹ | æ­£å¸¸ |

> âš ï¸ **åŒMEDIUMæ± **ï¼šBUFF_POOL_MAJOR åœ¨å½“å‰ `generateRewards` ä¸­**æœªè¢«ç›´æ¥ä½¿ç”¨**ã€‚BOSSæˆ˜å¥–åŠ±æ˜¯æ³•å®ä¸‰é€‰ä¸€ï¼Œä¸ä»å¤§æ¡£buffæ± æŠ½å–ã€‚**å±äºé¢„ç•™è®¾è®¡ï¼Œæš‚æœªç”Ÿæ•ˆã€‚**

### 1.5 é€Ÿé€šå¥–åŠ±æ± ï¼ˆBUFF_POOL_SPEEDKILLï¼Œå…±16ä¸ªï¼‰

| ID | åç§° | buffå­—æ®µ | æ•°å€¼ | ä»£ç ç”Ÿæ•ˆ | çŠ¶æ€ |
|----|------|---------|------|---------|------|
| s1 | [é€Ÿé€š] å›å¤20%è¡€é‡ | healNow | 20 | âœ… | æ­£å¸¸ |
| s2 | [é€Ÿé€š] å…¨é˜Ÿæ”»å‡» +4% | allAtkPct | +4 | âœ… | æ­£å¸¸ |
| s3 | [é€Ÿé€š] è¡€é‡ä¸Šé™ +6% | hpMaxPct | +6 | âœ… | æ­£å¸¸ |
| s4 | [é€Ÿé€š] å¿ƒç æ•ˆæœ +8% | heartBoostPct | +8 | âœ… | æ­£å¸¸ |
| s5 | [é€Ÿé€š] æ€ªç‰©è¡€é‡ -3% | enemyHpReducePct | +3 | âœ… | æ­£å¸¸ |
| s6 | [é€Ÿé€š] è½¬ç æ—¶é—´ +0.3ç§’ | extraTimeSec | +0.3 | âœ… | æ­£å¸¸ |
| s7 | [é€Ÿé€š] å›è¡€ +2/å›åˆ | regenPerTurn | +2 | âœ… | æ­£å¸¸ |
| s8 | [é€Ÿé€š] å—ä¼¤ -3% | dmgReducePct | +3 | âœ… | æ­£å¸¸ |
| s9 | [é€Ÿé€š] Comboä¼¤å®³ +4% | comboDmgPct | +4 | âœ… | æ­£å¸¸ |
| s10 | [é€Ÿé€š] å® ç‰©æŠ€èƒ½ä¼¤å®³ +4% | skillDmgPct | +4 | âœ… | æ­£å¸¸ |
| s11 | [é€Ÿé€š] ä¸‹åœºé¦–å›åˆä¼¤å®³ç¿»å€ | nextFirstTurnDouble | 1 | âœ… battle.js:498 applyFinalDamage | æ­£å¸¸ |
| s12 | [é€Ÿé€š] ä¸‹åœºæ•Œäººçœ©æ™•1å›åˆ | nextStunEnemy | 1 | âœ… battle.js:798 enterBattle | æ­£å¸¸ |
| s13 | [é€Ÿé€š] è·å¾—30ç‚¹æŠ¤ç›¾ | grantShield | 30 | âœ… skills.js:277 _addShield | æ­£å¸¸ |
| s14 | [é€Ÿé€š] å® ç‰©æŠ€èƒ½CDå…¨éƒ¨é‡ç½® | resetAllCd | 1 | âœ… skills.js:278 | æ­£å¸¸ |
| s15 | [é€Ÿé€š] è·³è¿‡ä¸‹ä¸€åœºæ™®é€šæˆ˜æ–— | skipNextBattle | 1 | âœ… runManager.js:70 | æ­£å¸¸ |
| s16 | [é€Ÿé€š] ä¸‹åœºå…ç–«ä¸€æ¬¡ä¼¤å®³ | immuneOnce | 1 | âœ… battle.js:751 applyEnemySkill | æ­£å¸¸ |

> é€Ÿé€šæ± ä»…åœ¨**æ™®é€šæˆ˜æ–—é€Ÿé€šæ—¶**ä½œä¸ºç¬¬4ä¸ªé¢å¤–é€‰é¡¹å‡ºç°ã€‚ç²¾è‹±/BOSSé€Ÿé€šåªå¢åŠ åŒç±»å‹ï¼ˆçµå…½/æ³•å®ï¼‰é¢å¤–é€‰é¡¹ã€‚

### 1.6 æˆ˜åå›è¡€æœºåˆ¶

èƒœåˆ©æ—¶æŒ‰ä»¥ä¸‹é¡ºåºå›è¡€ï¼ˆbattle.js:570-587ï¼‰ï¼š

| é¡ºåº | æ¥æº | æ¡ä»¶ | å›è¡€é‡ |
|------|------|------|--------|
| 1 | æ³•å® onKillHeal | weapon.type === 'onKillHeal' | heroMaxHp Ã— weapon.pct% |
| 2 | å® ç‰©buff onKillHeal | heroBuffsä¸­type=onKillHeal | heroMaxHp Ã— buff.pct% |
| 3 | runBuffs.postBattleHealPct | > 0 | heroMaxHp Ã— postBattleHealPct% |
| 4 | nextDmgReducePct æ¸…é›¶ | èƒœåˆ©åé‡ç½® | â€” |

### 1.7 é€Ÿé€šåˆ¤å®š

- **æ¡ä»¶**ï¼š`g.turnCount <= 5`ï¼ˆ5å›åˆå†…å‡»è´¥æ•Œäººï¼‰
- **è§¦å‘ç‚¹**ï¼šapplyFinalDamageã€enemyTurnï¼ˆåå¼¹/DOTæ€ï¼‰ã€startNextElimAnimï¼ˆæ³•å®AOEæ€ï¼‰ã€triggerPetSkillï¼ˆå® ç‰©æŠ€èƒ½æ€ï¼‰ã€DEVä¸€é”®ç§’æ€

---

## äºŒã€å¥‡é‡äº‹ä»¶å¥–åŠ±

### 2.1 å¥‡é‡äº‹ä»¶æ± ï¼ˆADVENTURESï¼Œå…±30ä¸ªï¼‰

| ID | åç§° | æè¿° | æ•ˆæœ | ä»£ç æ¶ˆè´¹ç‚¹ | çŠ¶æ€ |
|----|------|------|------|-----------|------|
| adv1 | è¯¯å…¥çµè„‰ | å…¨é˜Ÿæ”»å‡»+3% | allAtkUp | âœ… skills.js:331 runBuffs.allAtkPctç´¯åŠ  | æ­£å¸¸ |
| adv2 | æ¡åˆ°ä»™ä¸¹ | ç«‹å³å›è¡€50% | healPct | âœ… skills.js:332 å³æ—¶å›è¡€ | æ­£å¸¸ |
| adv3 | ä¸Šå¤æ´åºœ | è¡€é‡ä¸Šé™+10% | hpMaxUp | âœ… skills.js:333 å³æ—¶å¢åŠ heroMaxHp | æ­£å¸¸ |
| adv4 | å¤©é™çµç‰© | éšæœºè·å¾—ä¸€ä»¶æ³•å® | getWeapon | âœ… skills.js:334 åŠ å…¥weaponBag | æ­£å¸¸ |
| adv5 | ä»™å…½å¼•è·¯ | ä¸‹ä¸€å±‚å¿…å®šä¸é‡æ€ª | skipBattle | âœ… skills.js:335 â†’ runManager.js:70 | æ­£å¸¸ |
| adv6 | ç§˜å¢ƒæ³‰æ°´ | æ»¡è¡€å›å¤ | fullHeal | âœ… skills.js:336 heroHp=heroMaxHp | æ­£å¸¸ |
| adv7 | é“éª¨ä»™é£ | è½¬ç æ—¶é—´+0.5ç§’ | extraTime | âœ… skills.js:337 runBuffs.extraTimeSecç´¯åŠ  | æ­£å¸¸ |
| adv8 | çµçŸ³éåœ° | éšæœºå¼ºåŒ–ä¸€åªçµå…½ | upgradePet | âœ… skills.js:338 éšæœºå® ç‰©atkÃ—1.2 | æ­£å¸¸ |
| adv9 | ä»™å…‰æŠ¤ä½“ | è·å¾—ä¸€å±‚ä¸´æ—¶æŠ¤ç›¾ | shield | âœ… skills.js:339 _addShield(50) | æ­£å¸¸ |
| adv10 | å¤ç¬¦ç°ä¸– | ä¸‹æ¬¡æˆ˜æ–—æ€ªç‰©çœ©æ™•ä¸€å›åˆ | nextStun | âœ… skills.js:340 â†’ battle.js:798 | æ­£å¸¸ |
| adv11 | è‰æœ¨æ»‹å…» | æœ¨å±æ€§ä¼¤å®³+5% | attrDmgUp(wood) | âœ… skills.js:341 attrDmgPctç´¯åŠ  | æ­£å¸¸ |
| adv12 | é‡‘æ°´ç›¸åˆ | é‡‘+æ°´å±æ€§ä¼¤å®³+5% | multiAttrUp | âœ… skills.js:342 å¤šå±æ€§ç´¯åŠ  | æ­£å¸¸ |
| adv13 | ç«ç„°èµç¦ | ç«å±æ€§ä¼¤å®³+8% | attrDmgUp(fire) | âœ… skills.js:341 | æ­£å¸¸ |
| adv14 | å¤§åœ°åŠ æŒ | åœŸå±æ€§ä¼¤å®³+5% | attrDmgUp(earth) | âœ… skills.js:341 | æ­£å¸¸ |
| adv15 | é“å¿ƒç¨³å›º | ä¸‹æ¬¡æˆ˜æ–—Comboä¸ä¼šæ–­ | comboNeverBreak | âœ… skills.js:343 â†’ battle.js:92 | âš ï¸ è§å¤‡æ³¨1 |
| adv16 | ä»™äººç‚¹åŒ– | éšæœºè·å¾—ä¸€åªæ–°çµå…½ | getPet | âœ… skills.js:344 åŠ å…¥petBag | æ­£å¸¸ |
| adv17 | æ— å°˜ä¹‹åœ° | æ¸…é™¤æ‰€æœ‰è´Ÿé¢çŠ¶æ€ | clearDebuff | âœ… skills.js:345 è¿‡æ»¤bad buff | æ­£å¸¸ |
| adv18 | çµæ³‰æ´—ç¤¼ | å¿ƒç æ•ˆæœ+20% | heartBoost | âœ… skills.js:346 heartBoostPctç´¯åŠ  | æ­£å¸¸ |
| adv19 | ç¥å…µæ®‹å½± | æ³•å®æ•ˆæœä¸´æ—¶æå‡20% | weaponBoost | âœ… skills.js:347 weaponBoostPctç´¯åŠ  | âš ï¸ è§å¤‡æ³¨2 |
| adv20 | äº”è¡Œè°ƒå’Œ | å…¨å±æ€§ä¼¤å®³+3% | allDmgUp | âœ… skills.js:348 allDmgPctç´¯åŠ  | æ­£å¸¸ |
| adv21 | å±±ç¥èµç¦ | è¡€é‡ä¸Šé™+8% | hpMaxUp | âœ… åŒadv3 | æ­£å¸¸ |
| adv22 | å¦–å·¢ç©ºå¯‚ | ç›´æ¥è·³è¿‡ä¸€å±‚ | skipFloor | âœ… skills.js:349 g.floor++ | âš ï¸ è§å¤‡æ³¨3 |
| adv23 | ä¸Šå¤æˆ˜é­‚ | ä¸‹ä¸€å±‚ä¼¤å®³ç¿»å€ | nextDmgDouble | âœ… skills.js:350 â†’ battle.js:498 | æ­£å¸¸ |
| adv24 | é™å¿ƒå’’ | è½¬ç æ—¶é—´+1ç§’ | extraTime | âœ… skills.js:337 åŒadv7 | æ­£å¸¸ |
| adv25 | å¤©æŠ¤ | æŠµæŒ¡ä¸€æ¬¡è‡´å‘½æ”»å‡» | tempRevive | âœ… skills.js:351 â†’ runManager.js:169 | æ­£å¸¸ |
| adv26 | çµå…½è§‰é†’ | éšæœºä¸€åªçµå…½æ”»å‡»+10% | petAtkUp | âœ… skills.js:352 éšæœºå® ç‰©atkå¢åŠ  | æ­£å¸¸ |
| adv27 | ä»™é…¿ | å›è¡€70% | healPct | âœ… åŒadv2 | æ­£å¸¸ |
| adv28 | åœ°è„‰ä¹‹åŠ› | ä¸‹å›åˆå¿…å®šé«˜ç æ‰è½ | goodBeads | âœ… skills.js:353 â†’ battle.js:16,49 | æ­£å¸¸ |
| adv29 | ç ´é‚ª | å…ç–«ä¸‹ä¸€æ¬¡æ§åˆ¶ | immuneOnce | âœ… skills.js:354 â†’ battle.js:751 | æ­£å¸¸ |
| adv30 | æœºç¼˜ | ç›´æ¥è·å¾—ä¸‰é€‰ä¸€å¥–åŠ± | tripleChoice | âœ… skills.js:355 è·³è½¬rewardåœºæ™¯ | æ­£å¸¸ |

### 2.2 å¥‡é‡è§¦å‘è§„åˆ™

- **å‡ºç°æ¡ä»¶**ï¼š4å±‚èµ·å¯å‡ºç°ï¼Œæƒé‡éšå±‚æ•°é€’å¢
- **åŸºç¡€æƒé‡**ï¼šadventure=5ï¼ˆ4-6å±‚ä¸º8ï¼‰
- **åº”ç”¨æ–¹å¼**ï¼šè¿›å…¥eventåœºæ™¯æ—¶è‡ªåŠ¨åº”ç”¨ï¼ˆ`_adventureApplied`æ ‡è®°é˜²é‡å¤ï¼‰
- **äº¤äº’**ï¼šæ˜¾ç¤ºæ•ˆæœæè¿° â†’ ç‚¹å‡»"ç»§ç»­" â†’ `_nextFloor()`

### 2.3 å¤‡æ³¨

1. **âš ï¸ adv15 é“å¿ƒç¨³å›º**ï¼š`comboNeverBreak`åœ¨settle(battle.js:609)ä¸­æ¯æ¬¡å›åˆç»“ç®—åè¢«é‡ç½®ä¸ºfalseã€‚ä½†å¥‡é‡åº”ç”¨æ—¶è®¾ä¸ºtrueï¼Œè¿›å…¥æˆ˜æ–—ååªåœ¨**ç¬¬ä¸€è½®æ¶ˆé™¤**ç”Ÿæ•ˆï¼ˆsettleåæ¸…é›¶ï¼‰ã€‚æè¿°"ä¸‹æ¬¡æˆ˜æ–—Comboä¸ä¼šæ–­"å¯èƒ½è®©ç©å®¶ç†è§£ä¸ºæ•´åœºæˆ˜æ–—ä¸æ–­ï¼Œå®é™…åªæœ‰ç¬¬ä¸€è½®ã€‚**éœ€ç¡®è®¤æ˜¯å¦ä¸ºé¢„æœŸè®¾è®¡ã€‚**

2. **âš ï¸ adv19 ç¥å…µæ®‹å½±**ï¼š`weaponBoostPct`ä¸ºæ°¸ä¹…ç´¯åŠ åˆ°runBuffsï¼Œæè¿°å†™"ä¸´æ—¶æå‡"ä½†ä»£ç ä¸­æ— æ¸…é›¶é€»è¾‘ã€‚**å®é™…æ•ˆæœä¸ºæ°¸ä¹…æå‡ï¼Œä¸æè¿°ä¸ç¬¦ã€‚éœ€ç¡®è®¤ï¼šæ˜¯æ”¹ä¸ºä¸´æ—¶ï¼ˆå•åœºæˆ˜æ–—åæ¸…é›¶ï¼‰è¿˜æ˜¯æ”¹æè¿°ä¸ºæ°¸ä¹…ã€‚**

3. **âš ï¸ adv22 å¦–å·¢ç©ºå¯‚**ï¼š`skipFloor`ç›´æ¥`g.floor++`è·³å±‚ã€‚ä½†æ­¤æ—¶ç©å®¶è¿˜åœ¨å½“å‰å¥‡é‡äº‹ä»¶é¡µé¢ï¼Œç‚¹å‡»"ç»§ç»­"åä¼šè°ƒç”¨`_nextFloor()`å†æ¬¡`g.floor++`ï¼Œå¯¼è‡´**å®é™…è·³äº†2å±‚**è€Œé1å±‚ã€‚**è¿™æ˜¯ä¸€ä¸ªbugã€‚**

---

## ä¸‰ã€ä¼‘æ¯å¥–åŠ±

### 3.1 ä¼‘æ¯é€‰é¡¹æ± ï¼ˆREST_OPTIONSï¼Œå…±2ä¸ªï¼‰

| ID | åç§° | æè¿° | æ•ˆæœ | ä»£ç æ¶ˆè´¹ç‚¹ | çŠ¶æ€ |
|----|------|------|------|-----------|------|
| rest1 | ä¼‘æ¯å›è¡€ | å›å¤50%æœ€å¤§è¡€é‡ | healPct, pct:50 | âœ… skills.js:321-322 å³æ—¶å›è¡€ | æ­£å¸¸ |
| rest2 | ä¿®ç‚¼å¢å¼º | æ”»å‡»+5% | allAtkUp, pct:5 | âœ… skills.js:323-324 runBuffs.allAtkPctç´¯åŠ  | æ­£å¸¸ |

### 3.2 ä¼‘æ¯è§¦å‘è§„åˆ™

- **å‡ºç°æ¡ä»¶**ï¼š4å±‚èµ·å¯å‡ºç°ï¼Œæƒé‡éšå±‚æ•°é€’å¢
- **åŸºç¡€æƒé‡**ï¼šrest=3ï¼ˆ4-6å±‚ä¸º3ï¼Œåç»­é€’å¢ï¼‰
- **äº¤äº’**ï¼šäºŒé€‰ä¸€ï¼Œç‚¹å‡»å³ç”Ÿæ•ˆå¹¶è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å±‚

---

## å››ã€å•†åº—å¥–åŠ±

### 4.1 å•†åº—ç‰©å“æ± ï¼ˆSHOP_ITEMSï¼Œå…±6ä¸ªï¼‰

| ID | åç§° | æ•ˆæœ | ä»£ç æ¶ˆè´¹ç‚¹ | çŠ¶æ€ |
|----|------|------|-----------|------|
| shop1 | éšæœºæ–°çµå…½ä¸€åª | getPet | âœ… skills.js:290-294 | æ­£å¸¸ |
| shop2 | éšæœºæ³•å®ä¸€ä»¶ | getWeapon | âœ… skills.js:296-301 | æ­£å¸¸ |
| shop3 | æ»¡è¡€å›å¤ | fullHeal | âœ… skills.js:303-304 | æ­£å¸¸ |
| shop4 | éšæœºå¼ºåŒ–ä¸€åªçµå…½(æ”»å‡»+20%) | upgradePet | âœ… skills.js:305-308 | æ­£å¸¸ |
| shop5 | ç§»é™¤æ‰€æœ‰è´Ÿé¢çŠ¶æ€ | clearDebuff | âœ… skills.js:309-310 | æ­£å¸¸ |
| shop6 | è¡€é‡ä¸Šé™+10% | hpMaxUp | âœ… skills.js:311-314 | æ­£å¸¸ |

### 4.2 å•†åº—è§¦å‘è§„åˆ™

- **å‡ºç°æ¡ä»¶**ï¼š7å±‚èµ·å¯å‡ºç°
- **åŸºç¡€æƒé‡**ï¼šshop=4ï¼Œåç»­é€’å¢
- **äº¤äº’**ï¼šéšæœºå±•ç¤º3ä¸ªå•†å“ï¼Œå…è´¹é€‰1ä¸ªï¼Œé€‰åè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å±‚
- **é™åˆ¶**ï¼š`_eventShopUsed`æ ‡è®°é˜²é‡å¤é€‰æ‹©

---

## äº”ã€æ³•å®æ¯å±‚è‡ªåŠ¨åŠ æˆ

| æ¡ä»¶ | æ•ˆæœ | ä»£ç ä½ç½® |
|------|------|---------|
| weapon.type === 'perFloorBuff' ä¸” (floor-1) % weapon.per === 0 | field='atk': allAtkPct + pct%; field='hpMax': heroMaxHpå¢åŠ pct% | runManager.js:62-68 nextFloorä¸­ |

---

## å…­ã€å¤æ´»æœºåˆ¶

| ä¼˜å…ˆçº§ | æ¥æº | æ¡ä»¶ | å›è¡€é‡ | çŠ¶æ€ |
|--------|------|------|--------|------|
| 1 | å¤©æŠ¤(tempRevive) | tempRevive=true | 30%æœ€å¤§è¡€é‡ | âœ… æ­£å¸¸ |
| 2 | å¥‡è¿¹å¤æ´»(extraRevive) | runBuffs.extraRevive > 0 | 25%æœ€å¤§è¡€é‡ | âœ… æ­£å¸¸ |
| 3 | æ³•å®ä¸ç­é‡‘èº« | weapon.type='revive' ä¸”æœªç”¨è¿‡ | 20%æœ€å¤§è¡€é‡ | âœ… æ­£å¸¸ |
| 4 | å¹¿å‘Šå¤æ´» | adReviveUsed=false | æ»¡è¡€+æ¸…é™¤è´Ÿé¢ | âœ… æ­£å¸¸ |
| 5 | æ— å¤æ´» | ä»¥ä¸Šå…¨ä¸æ»¡è¶³ | â€” è¿›å…¥defeat | âœ… æ­£å¸¸ |

---

## ä¸ƒã€å­˜åœ¨çš„é—®é¢˜æ±‡æ€»

### ğŸ› Bug

| # | é—®é¢˜ | ä½ç½® | è¯´æ˜ |
|---|------|------|------|
| 1 | **adv22 å¦–å·¢ç©ºå¯‚è·³å±‚ç¿»å€** | skills.js:349 + eventViewè§¦å‘nextFloor | `skipFloor`æ•ˆæœæ‰§è¡Œ`g.floor++`ï¼Œä½†ä¹‹åç‚¹å‡»"ç»§ç»­"åˆä¼šè°ƒç”¨`nextFloor()`å†æ¬¡`floor++`ï¼Œå®é™…è·³äº†2å±‚ã€‚åº”æ”¹ä¸ºè®¾ç½®æ ‡å¿—ä½ï¼Œåœ¨nextFloorä¸­æ¶ˆè´¹ã€‚ |

### âš ï¸ è®¾è®¡ç–‘é—®ï¼ˆå¾…ç¡®è®¤ï¼‰

| # | é—®é¢˜ | è¯´æ˜ |
|---|------|------|
| 1 | **BUFF_POOL_MEDIUM/MAJOR æœªè¢«ä½¿ç”¨** | ä¸­æ¡£å’Œå¤§æ¡£buffæ± å®šä¹‰äº†34ä¸ªbuffï¼Œä½†generateRewardsä¸­ç²¾è‹±æˆ˜å¥–åŠ±æ˜¯çµå…½ã€BOSSæˆ˜å¥–åŠ±æ˜¯æ³•å®ï¼Œè¿™ä¸¤ä¸ªæ± å­ä»æœªè¢«æŠ½å–ã€‚æ˜¯å¦éœ€è¦æ··å…¥å¯¹åº”æˆ˜æ–—çš„å¥–åŠ±é€‰é¡¹ä¸­ï¼Ÿ |
| 2 | **adv15 é“å¿ƒç¨³å›ºåªç”Ÿæ•ˆ1è½®** | comboNeverBreakåœ¨æ¯å›åˆsettleåè¢«æ¸…é›¶ï¼Œå®é™…åªæœ‰ç¬¬ä¸€è½®æ¶ˆé™¤Comboä¸æ–­ã€‚æè¿°"ä¸‹æ¬¡æˆ˜æ–—Comboä¸ä¼šæ–­"æ˜¯å¦æŒ‡æ•´åœºï¼Ÿ |
| 3 | **adv19 ç¥å…µæ®‹å½±æ˜¯æ°¸ä¹…è€Œéä¸´æ—¶** | weaponBoostPctç´¯åŠ åˆ°runBuffsåæ— æ¸…é›¶é€»è¾‘ï¼Œå®é™…ä¸ºæ°¸ä¹…åŠ æˆã€‚æè¿°å†™"ä¸´æ—¶æå‡"æ˜¯å¦éœ€è¦æ”¹ä¸ºå•åœºæˆ˜æ–—åæ¸…é›¶ï¼Ÿ |
| 4 | **ç­–åˆ’æ¡ˆ80ä¸ªå¥–åŠ± vs ä»£ç å®ç°** | ç­–åˆ’æ¡ˆä¸­æœ‰80ä¸ªå¥–åŠ±ï¼ˆå››å¤§ç±»å„20ä¸ªï¼‰ï¼Œä½†ä»£ç å®ç°çš„å¥–åŠ±æ± æ€»å…±64ä¸ªï¼ˆå°14+ä¸­16+å¤§18+é€Ÿé€š16ï¼‰ã€‚ç­–åˆ’æ¡ˆä¸­éƒ¨åˆ†å¥–åŠ±æœªå®ç°ï¼šå® ç‰©/æ­¦å™¨èƒŒåŒ…ä¸Šé™+1ã€å…è´¹åˆ·æ–°å¥–åŠ±æ± /äº‹ä»¶ã€ç¥ç§˜å•†åº—8æŠ˜ã€é¢„è§ˆ3å±‚äº‹ä»¶ã€æœ¬åœº/ä¸‹åœºè½¬ç æ—¶é—´+Nç§’ï¼ˆæˆ˜æ–—è¾…åŠ©ç±»ï¼‰ã€é‡æ–°è½¬ç æœºä¼šã€è‡ªåŠ¨å¸é™„ã€è½¬ç ç›˜ç”Ÿæˆå¿ƒç /äº”è¡Œç ã€æ¸…é™¤éšœç¢ç ã€å¼€å±€è‡ªåŠ¨3æ¶ˆç­‰ã€‚è¿™äº›æ˜¯åç»­è¿­ä»£è¿˜æ˜¯å·²æ”¾å¼ƒï¼Ÿ |
| 5 | **immuneOnce ä»…å¯¹ stun ç±»æŠ€èƒ½ç”Ÿæ•ˆ** | battle.js:751 ä¸­ immuneOnce åªåœ¨ `stun` ç±»æ•Œæ–¹æŠ€èƒ½æ—¶æ£€æŸ¥ã€‚æè¿°ä¸º"å…ç–«ä¸€æ¬¡æ§åˆ¶"ï¼Œä½†å¯¹ sealï¼ˆç¦ç ï¼‰ç­‰æ§åˆ¶ç±»æŠ€èƒ½ä¸ç”Ÿæ•ˆã€‚æ˜¯å¦éœ€è¦æ‰©å±•ï¼Ÿ |
| 6 | **weaponBoostPct å±•ç¤ºå€¼æœªè®¡å…¥** | weaponBoostPct åœ¨ applyFinalDamageï¼ˆå®é™…ç»“ç®—ï¼‰ä¸­ç”Ÿæ•ˆï¼Œä½†åœ¨ enterPetAtkShowï¼ˆä¼¤å®³å±•ç¤ºï¼‰ä¸­æœªåº”ç”¨ï¼Œå¯¼è‡´UIå±•ç¤ºçš„æ”»å‡»ä¼¤å®³æ•°å€¼æ¯”å®é™…åä½ã€‚ |

---

## å…«ã€å…¨å±€BuffçŠ¶æ€å­—æ®µä¸€è§ˆï¼ˆrunBuffsï¼‰

| å­—æ®µ | åˆå§‹å€¼ | æ¥æº | æˆ˜æ–—æ¶ˆè´¹ç‚¹ | æŒç»­æ€§ |
|------|--------|------|-----------|--------|
| allAtkPct | 0 | buff/rest/adventure | battle.jsæ¶ˆé™¤è®¡ç®— | æ°¸ä¹… |
| allDmgPct | 0 | adventure(allDmgUp) | battle.jså…¨ä¼¤å®³ä¹˜æ•° | æ°¸ä¹… |
| attrDmgPct | {å„å±æ€§:0} | adventure(attrDmgUp/multiAttrUp) | battle.jså±æ€§ä¼¤å®³ä¹˜æ•° | æ°¸ä¹… |
| heartBoostPct | 0 | buff/adventure | battle.jså¿ƒç å›å¤ä¹˜æ•° | æ°¸ä¹… |
| weaponBoostPct | 0 | adventure(weaponBoost) | battle.jsæ³•å®ä¼¤å®³ä¹˜æ•° | æ°¸ä¹… |
| extraTimeSec | 0 | buff/adventure | battle.jsæ‹–æ‹½æ—¶é™ | æ°¸ä¹… |
| hpMaxPct | 0 | buff | skills.jsé‡ç®—heroMaxHp | æ°¸ä¹… |
| comboDmgPct | 0 | buff | battle.js comboå€ç‡ | æ°¸ä¹… |
| elim3DmgPct | 0 | buff | battle.js 3æ¶ˆå€ç‡ | æ°¸ä¹… |
| elim4DmgPct | 0 | buff | battle.js 4æ¶ˆå€ç‡ | æ°¸ä¹… |
| elim5DmgPct | 0 | buff | battle.js 5æ¶ˆå€ç‡ | æ°¸ä¹… |
| counterDmgPct | 0 | buff | battle.jså…‹åˆ¶ä¼¤å®³ | æ°¸ä¹… |
| skillDmgPct | 0 | buff | skills.jsæŠ€èƒ½ä¼¤å®³ | æ°¸ä¹… |
| skillCdReducePct | 0 | buff | skills.jsæŠ€èƒ½CDç¼©çŸ­ | æ°¸ä¹… |
| regenPerTurn | 0 | buff | battle.jsæ¯å›åˆå›è¡€ | æ°¸ä¹… |
| dmgReducePct | 0 | buff | battle.jså‡ä¼¤ | æ°¸ä¹… |
| bonusCombo | 0 | buff(å¤§æ¡£) | battle.jsé¦–æ¬¡æ¶ˆé™¤+Nè¿å‡» | æ°¸ä¹… |
| stunDurBonus | 0 | buff(å¤§æ¡£) | battle.js 5æ¶ˆçœ©æ™•å»¶é•¿ | æ°¸ä¹… |
| enemyAtkReducePct | 0 | buff | battle.jsè¿›æˆ˜å‰Šå¼± | æ°¸ä¹… |
| enemyHpReducePct | 0 | buff | battle.jsè¿›æˆ˜å‰Šå¼± | æ°¸ä¹… |
| enemyDefReducePct | 0 | buff | battle.jsè¿›æˆ˜å‰Šå¼± | æ°¸ä¹… |
| eliteAtkReducePct | 0 | buff(ä¸­æ¡£) | battle.jsç²¾è‹±å‰Šå¼± | æ°¸ä¹… |
| eliteHpReducePct | 0 | buff(ä¸­æ¡£) | battle.jsç²¾è‹±å‰Šå¼± | æ°¸ä¹… |
| bossAtkReducePct | 0 | buff(å¤§æ¡£) | battle.js BOSSå‰Šå¼± | æ°¸ä¹… |
| bossHpReducePct | 0 | buff(å¤§æ¡£) | battle.js BOSSå‰Šå¼± | æ°¸ä¹… |
| nextDmgReducePct | 0 | buff | battle.jså‡ä¼¤ï¼Œ**èƒœåˆ©åæ¸…é›¶** | å•åœº |
| postBattleHealPct | 0 | buff | battle.jsèƒœåˆ©å›è¡€ | æ°¸ä¹… |
| extraRevive | 0 | buff(å¤§æ¡£) | runManager.jså¤æ´»æ¶ˆè´¹-1 | å¯æ¶ˆè€— |

---

## ä¹ã€ä¸€æ¬¡æ€§Flagä¸€è§ˆ

| Flag | åˆå§‹å€¼ | æ¥æº | æ¶ˆè´¹ç‚¹ | æ¶ˆè´¹å |
|------|--------|------|--------|--------|
| skipNextBattle | false | buff/adventure | runManager.js nextFloor | é‡ç½®false |
| nextStunEnemy | false | buff/adventure | battle.js enterBattle | é‡ç½®false |
| nextDmgDouble | false | buff/adventure | battle.js applyFinalDamage | é‡ç½®false |
| tempRevive | false | å® ç‰©æŠ€èƒ½/adventure | runManager.js onDefeat | é‡ç½®false |
| immuneOnce | false | buff/adventure | battle.js applyEnemySkill | é‡ç½®false |
| comboNeverBreak | false | å® ç‰©æŠ€èƒ½/buff/adventure | battle.js settle | æ¯å›åˆé‡ç½®false |
| goodBeadsNextTurn | false | å® ç‰©æŠ€èƒ½/adventure | battle.js initBoard/fillBoard | é‡ç½®false |
| weaponReviveUsed | false | æ³•å®è§¦å‘ | runManager.js onDefeat | è®¾ä¸ºtrueï¼ˆå±€å†…ä¸å¯æ¢å¤ï¼‰ |
| adReviveUsed | false | å¹¿å‘Šå¤æ´» | runManager.js adReviveCallback | è®¾ä¸ºtrueï¼ˆå±€å†…ä¸å¯æ¢å¤ï¼‰ |
